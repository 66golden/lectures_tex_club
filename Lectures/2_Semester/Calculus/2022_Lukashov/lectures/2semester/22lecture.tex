\textcolor{red}{Сюда бы картиночку с конца 21й лекции весны 2022}

\begin{proof}
	Разобьём полуинтервал $[0; +\infty)$ на малые полуинтервалы:
	\[
		\forall m \in \N\ \ [0; +\infty) = \bscup_{l = 0}^\infty \left[\frac{l}{2^m}; \frac{l + 1}{2^m}\right)
	\]
	Рассмотрим множества $E_{l, m} = \{x \in E \colon f(x) \in [l / 2^m; (l + 1) / 2^m)\}$. Они измеримы, ибо их можно представить в таком виде:
	\[
		E_{l, m} = E_{\frac{l + 1}{2^m}}(f) \bs E_{\frac{l}{2^m}}(f)
	\]
	Более того, область определения исходной функции выражается следующим образом:
	\[
		\forall m \in \N \quad E = \bscup_{l = 0}^\infty E_{l, m}
	\]
	Теперь, определим $h_m(x)$ так:
	\[
		\forall l, m\ \left(\forall x \in E_{l, m} \Ra h_m(x) = \frac{l}{2^m}\right)
	\]
	Полученная функция имеет не более чем счётное число значений и она измерима (например, потому что записывается в виде ступенчатой функции). Следовательно, она ступенчатая. При этом
	\[
		\forall m \in \N\ \forall x \in E \quad 0 \le f(x) - h_m(x) \le \frac{1}{2^m}
	\]
	Значит, последовательность равномерно сходится к $f(x)$. Остаётся показать, что $\forall x \in E$ она будет неубывающей. Заметим следующий факт:
	\[
		\left[\frac{l}{2^m}; \frac{l + 1}{2^m}\right) = \left[\frac{2l}{2^{m + 1}}; \frac{2l + 1}{2^{m + 1}}\right) \sqcup \left[\frac{2l + 1}{2^{m + 1}}; \frac{2l + 2}{2^{m + 1}}\right)
	\]
	Отсюда $\forall x \in E_{l, m}$ верно, что $h_m(x) \le h_{m + 1}(x)$.
\end{proof}

\begin{note}
	Доказанная теорема очень легко расширяется на случаи, когда $f$ отображает в отрицательные числа или в конечный промежуток.
\end{note}

\begin{definition}
	Последовательность измеримых функций $\{f_m\}_{m = 1}^\infty$ \textit{сходится к измеримой функции $f$ на $E \subset \R^n$ по мере}, если
	\[
		\forall \eps > 0 \quad \lim_{m \to \infty} \mu(\{x \in E \colon |f_m(x) - f(x)| \ge \eps\}) = 0
	\]
	Обозначается как $f_m \Ra f$
\end{definition}

\begin{note}
	Далее под сходимостью функциональной последовательности почти всюду подразумевается поточечная сходимость почти всюду.
\end{note}

\begin{theorem} (Связь сходимостей по мере и почти всюду) \label{th2}
	Пусть $\{f_m\}_{m = 1}^\infty$ - последовательность измеримых на $E$ функций, и выполнены следующие требования:
	\begin{enumerate}
		\item $E$ - измеримое множество конечной меры
		
		\item $\forall m \in \N\ f_m$ - почти всюду конечная на $E$
		
		\item $f_m \to f$ почти всюду на $E$
	\end{enumerate}
	Тогда $f_m \Ra f$ по мере на $E$.
\end{theorem}

\begin{note}
	Поясним, как понимать неравенство из определения сходимости по мере, если при некоторых $x$ у нас будут бесконечности:
	\begin{itemize}
		\item Если только 1 значение обращается в бесконечность, то модуль рассматривается как положительная бесконечность и всё хорошо
		
		\item Если 2 значения обращаются в бесконечность, то мы считаем, что \textcolor{red}{вот что? Почему это работает? Надо уточнять}
	\end{itemize}
\end{note}

\begin{proof}
	Сразу обозначим через $E_0$ множество всех плохих точек:
	\[
		E_0 = \{x \in E \colon (\exists m \in \N\ f_m(x) = \pm\infty) \vee (f_m(x) \centernot\to f(x)) \vee (f(x) = \pm\infty)\}
	\]
	По условию и в силу счётной аддитивности, $\mu(E_0) = 0$. Дополнительно введём следующее обозначение:
	\[
		E_m(\eps) := \{x \in E \such |f_m(x) - f(x)| \ge \eps\}
	\]
	Теперь хотим доказать, что $\varlimsup_{m \to \infty} E_m(\eps) \subset E_0$. Это эквивалентно такому условию:
	\[
		x \notin E_0 \Ra x \notin \varlimsup_{m \to \infty} E_m(\eps)
	\]
	Действительно, если $x \notin E_0$, то значит $f_m(x) \to f$. По определению это даёт следующее:
	\[
		\forall \eps > 0\ \exists M \in \N \such \forall m > M \quad \underbrace{|f_m(x) - f(x)| < \eps}_{x \notin E_m(\eps)}
	\]
	Отсюда уже очевидно по определению верхнего предела, что $x \notin \varlimsup_{m \to \infty} E_m(\eps)$. Вспомним о лемме \label{lem1}, по которой уже получим верхний предел мер:
	\[
		0 \le \varlimsup_{m \to \infty} \mu(E_m(\eps)) \le \mu(\varlimsup_{m \to \infty} E_m(\eps)) \le \mu(E_0) = 0
	\]
	Стало быть $\varliminf_{m \to \infty} \mu(E_m(\eps)) = 0$ и просто предел тоже равен нулю.
\end{proof}

\begin{example} (Пример к тому, что обратное утверждение неверно. Автор Фридьеш Рисс)
	Запишем все натуральные числа в следующем виде:
	\[
		\forall m \in \N\ \exists k \in \N, j \in \{0, \ldots, 2^k - 1\} \such m = 2^k + j
	\]
	Введём $\{f_m\}_{m = 0}^\infty$ следующим образом:
	\[
		f_m(x) := \chi_{[j / 2^k; (j + 1) / 2^k]}(x)
	\]
	\textcolor{red}{Сюда бы картиночку с 22й лекции весны 2022, 27:40}
	\begin{itemize}
		\item Посмотрим, куда сходится такая последовательность по мере. Зафиксируем $\eps > 0$, тогда
		\[
			\mu(\{x \in [0; 1] \colon |f_m(x)| \ge \eps\}) \xrightarrow[m \to \infty]{} 0
		\]
		то есть $f_m \Ra f = 0$.
		
		\item Однако, для любого $x \in [0; 1]$ будут существовать сколь угодно большие $m \in \N$ такие, что $f_m(x)$ принимает значение как 0, так и 1. Стало быть, $f_m \centernot\to 0$.
	\end{itemize}
\end{example}

\begin{note}
	Если $\mu(E) = +\infty$, то утверждение теоремы также неверно. Положим $f_m = \chi_{[-m; m]}$, тогда
	\[
		\forall x \in \R\ \lim_{m \to \infty} f_m(x) = 1 = f(x)
	\]
	Но отсюда будет следовать, что
	\[
		\forall \eps \in (0; 1), m \in \N \quad \mu(\{x \in \R \colon |f_m(x) - f(x)| \ge \eps\}) = \mu((-\infty; -m] \cup [m; +\infty)) = +\infty
	\]
\end{note}

\begin{theorem} (Фридьеша Рисса)
	Если $f_m \Ra f$ на измеримом $E$, то существует подпоследовательность $\{f_{m_k}\}_{k = 1}^\infty$, сходящаяся почти всюду на $E$ к $f$.
\end{theorem}

\begin{proof}
	Распишем по определению сходимость по мере:
	\[
		\forall \eps > 0 \quad \lim_{m \to \infty} \mu(\{x \in E \colon |f_m(x) - f(x)| \ge \eps\}) = 0
	\]
	Последовательно рассмотрим $\eps = 1, 1/2, 1/3, \ldots$ Тогда
	\[
		\forall k \in \N\ \exists n_k \in \N \such \mu(\underbrace{\{x \in E \colon |f_{n_k}(x) - f(x)| \ge 1/k\}}_{E_{n_k}(1/k)}) < \frac{1}{2^k}
	\]
	Более того, мы можем потребовать, что $n_1 < n_2 < \ldots$ Теперь, рассмотрим множество $Q$ следующего вида:
	\[
		Q := \bigcap_{m = 1}^\infty \bigcup_{k = m}^\infty E_{n_k}\ps{\frac{1}{k}} = \lim_{m \to \infty} \bigcup_{k = m}^\infty E_{n_k}\ps{\frac{1}{k}}
	\]
	Для объединения множеств можно сделать оценку на меру:
	\[
		\mu\ps{\bigcup_{k = m}^\infty E_{n_k}\ps{\frac{1}{k}}} \le \sum_{k = m}^\infty \mu\ps{E_{n_k}\ps{\frac{1}{k}}} \le \sum_{k = m}^\infty \frac{1}{2^k} = \frac{1}{2^{m - 1}}
	\]
	Отсюда получаем меру $\mu(Q)$:
	\[
		\mu(Q) = \lim_{m \to \infty} \mu\ps{\bigcup_{k = m}^\infty E_{n_k}\ps{\frac{1}{k}}} = 0
	\]
	Остаётся показать, что полученная подпоследовательность $\{f_{n_k}\}_{k = 1}^\infty$ сходится поточечно на $E \bs Q$. Действительно, если $x_0 \in E \bs Q$, то тогда $x_0 \notin \bigcup_{k = m_0}^\infty E_{n_k}(1/k)$, а значит
	\[
		\forall k \ge m_0\ |f_{n_k}(x_0) - f(x_0)| < \frac{1}{k}
	\]
\end{proof}

\begin{note}
	Дальнейшие именные теоремы устанавливают факты, которые можно было бы описать вместе следующим образом:
	
	<<Если из почти всюду хорошей функции убрать эти почти всюду, то она станет идеальной>>.
\end{note}

\begin{theorem} (Д.Ф. Егорова)
	Пусть для последовательности измеримых на $E$ конечной меры функций $\{f_m\}_{m = 1}^\infty$ верны следующие свойства:
	\begin{enumerate}
		\item $\forall m \in \N\ \ f_m$ - почти всюду конечная функция на $E$
		
		\item $f_m \to f$ почти всюду на $E$
		
		\item $f$ почти всюду конечна на $E$
	\end{enumerate}
	Тогда имеет место такое утверждение:
	\[
		\forall \eps > 0\ \exists E_\eps < E,\ \mu(E \bs E_\eps) < \eps \such f_m \rra f \text{ на } E_\eps
	\]
\end{theorem}

\begin{proof}
	Как и ранее, обозначим за $E_0$ множество всех <<плохих>> точек. Повторяя доказательство теоремы \ref{th2}, вернёмся к следующему доказанному факту:
	\[
		\varlimsup_{m \to \infty} E_m(\eps) \subset E_0
	\]
	Иначе говоря, $\bigcap_{m = 1}^\infty \bigcup_{k = m}^\infty E_k(1/k) \subset E_0$. Стало быть, если положить $\eps = \frac{1}{i}$ для некоторого $i \in \N$, то
	\[
		\mu\ps{\bigcap_{m = 1}^\infty \bigcup_{k = m}^\infty E_k\ps{\frac{1}{i}}} = \lim_{m \to \infty} \mu\ps{\bigcup_{k = m}^\infty E_k\ps{\frac{1}{i}}} = \mu(E_0) = 0
	\]
	Из предела следует, что
	\[
		\forall \eps' > 0\ \exists m_i \such \forall m \ge m_i \quad \mu\ps{\bigcup_{k = m}^\infty E_k\ps{\frac{1}{i}}} < \frac{\eps'}{2^{i + 1}}
	\]
	Ну и теперь, обозначая $e := E \bs E_{\eps'} = \bigcup_{i = 1}^\infty \bigcup_{k = m_i}^\infty E_k(1/i)$, оцениваем меру этого множества:
	\[
		\forall \eps' > 0\ \ \mu(e) \le \sum_{i = 1}^\infty \mu\ps{\bigcup_{k = m_i}^\infty E_k\ps{\frac{1}{i}}} \le \sum_{i = 1}^\infty \frac{\eps'}{2^{i + 1}} = \frac{\eps'}{2} < \eps' \Lora \mu(e) = 0
	\]
	Остаётся показать, что есть равномерная сходимость на $E \bs e$. Для этого рассмотрим произвольный $x \in E \bs e$. Тогда
	\[
		x \notin \bigcup_{i = 1}^\infty \bigcup_{k = m_i}^\infty E_k\ps{\frac{1}{i}} \Lora \forall i\ \forall k \ge m_i\ \ x \notin E_k\ps{\frac{1}{i}} \Lora \forall i\ \forall k \ge m_i\ \ |f_k(x) - f(x)| < \frac{1}{i}
	\]
	Значит, если рассмотреть $\forall \delta > 0$, то найдётся $i \in \N \colon 1/i < \delta$ и соответствующее $m_i$ такие, что
	\[
		\forall \delta > 0\ \exists m_i \in \N \such \forall k \ge m_i, x \in E \bs e \quad |f_k(x) - f(x)| < \frac{1}{i} < \delta \Longleftrightarrow f_k \rra f \text{ на } E_{\eps'}
	\]
\end{proof}

\begin{theorem} (Структура открытых множеств в $\R$)
	Каждое открытое множество на действительной прямой представимо объединением не более чем счётного числа непересекающихся интервалов.
\end{theorem}

\begin{reminder}
	\textit{Интервалом} мы называем $(a; b)$, где $a < b$.
\end{reminder}

\begin{proof}
	Пусть $G \subset \R$ - рассматриваемое открытое множество. Введём на $G$ отношение эквивалентности:
	\[
		x \sim y \Lra (x, y) \subset G
	\]
	То, что это действительно задаёт отношение эквивалентности, остаётся в качестве домашнего задания читателю. Как следствие, мы можем переписать $G$ в виде дизъюнктного объединения:
	\[
		G = \bscup_{i = 1}^\infty \wt{C}_i
	\]
	Рассмотрим конкретный $\wt{C}_i$. Пусть $a = \inf \wt{C}_i$, $b = \sup \wt{C}_i$. Мы докажем, что $\wt{C}_i = (a; b)$ в два хода:
	\begin{itemize}
		\item (Любая точка между границами лежуит внутри класса) Возьмём $\forall c \in (a; b)$. Тогда, в силу определений инфинума и супремума:
		\[
			\exists a_1 \in \wt{C}_i \cap (a; c), b_1 \in \wt{C}_i \cap (c; b) \Ra (a_1; b_1) \subset G \Ra c \in G
		\]
		Так как $(a_1; c) \subset G$, то $c \in \wt{C}_i$.
		
		\item (Краевые точки не лежат в классе) Докажем от противного: пусть $a \in \wt{C}_i \cap G$. Но при этом $G$ - открытое множество, стало быть
		\[
			\exists \delta > 0 \such (a - \delta; a + \delta) \subset G
		\]
		Но тогда $a + \delta / 2 \in (a; b) \Ra a + \delta / 2 \in \wt{C}_i \Ra a - \delta / 2 \in \wt{C}_i$, получили противоречие с определением инфинума. Аналогичные рассуждения повторяем для $b$.
	\end{itemize}
\end{proof}

\begin{theorem} (Н.Н. Лузина)
	Если $f(x)$ - измеримая, почти всюду конечная на $[a; b]$ функция, то
	\[
		\forall \eps > 0\ \exists \phi(x) \in C[a; b] \such \mu(\{x \in [a; b] \colon f(x) \neq \phi(x)\}) < \eps
	\]
	При этом, если $f(x)$ ограничена некоторым $K > 0$ по модулю, то то же самое справедливо для $\phi(x)$.
\end{theorem}

\begin{exercise}
	Для доказательства теоремы будет полезно знать следующий факт:
	
	$f(x) \colon \R \to \R$ непрерывна слева в точке $x_0$ тогда и только тогда, когда для любой сходящейся к $x_0$ последовательности $\{x_k\}_{k = 0}^\infty$, у которой $\forall i \in \N\ x_i < x_{i + 1}$, существует предел $\liml_{k \to \infty} f(x_k) = f(x_0)$.
	
	Аналогично для непрерывности справа.
\end{exercise}

\begin{proof}~
	\begin{itemize}
		\item Рассмотрим случай не просто всюду конечной функции, а ограниченной: $\exists K > 0 \such \forall x \in [a; b]\ |f(x)| \le K$. По теореме о представлении в виде предела равномерно сходящейся последовательности ступенчатых функций
		\[
			f(x) = \lim_{n \to \infty} h_n(x)
		\]
		при этом $h_n(x)$ постоянны на своих множествах $I_{k, n}$ таких, что $\bscup_{k = 1}^{k_n} I_{k, n} = [a; b]$ и $\forall n \in \N,\ k \in \range{k_n}\ I_{k, n} \cong \R$. Более того, имеет место следующая формула для нижней меры у каждого из таких множеств:
		\[
			\mu(I_{k, n}) = \mu_*(I_{k, n}) = \sup_{F \subset I_{k, n}} \mu(F),\ \text{ где $F$ --- замкнутое}
		\]
		Теперь, зафиксируем $\eps > 0$ и найдём для каждого $n$ все замкнутые приближающие множества:
		\[
			\forall n \in \N\ \forall k \in \range{k_n}\ \exists F_{k, n} \subset I_{k, n} \text{ --- замкнутое} \such \mu(I_{k, n} \bs F_{k, n}) < \frac{\eps \cdot 2^{- n - 1}}{k_n}
		\]
		Обозначим $K_n := \bscup_{k = 1}^{k_n} F_{k, n}$ - замкнутое множество. Стало быть, $K_\eps := \bigcap_{n = 1}^\infty K_n$ - тоже замкнутое. Последнее будет тем множеством, на котором наша будущая непрерывная функция будет совпадать с $f$. Проверим меру дополнения:
		\begin{multline*}
			\mu([a; b] \bs K_{\eps}) = \mu\ps{\bigcup_{n = 1}^\infty ([a; b] \bs K_n)} \le \sum_{n = 1}^\infty \mu([a; b] \bs K_n) =
			\\
			\sum_{n = 1}^\infty \sum_{k = 1}^{k_n} \mu(I_{k, n} \bs F_{k, n}) \le \sum_{n = 1}^\infty \eps \cdot 2^{-n - 1} \le \frac{\eps}{2} < \eps
		\end{multline*}
		Наконец-то можно построить функцию. Положим $\alpha := \inf K_\eps$, $\beta := \sup K_\eps$. Эти точки лежат в $K_\eps$ в силу замкнутости. Сделаем $\phi$ такой:
		\[
			\phi(x) := \System{
				&{f(x),\ x \in K_\eps}
				\\
				&{const,\ x \in [a; \alpha] \cup [\beta; b]}
				\\
				&{\text{линейна на интервалах $(c_k; d_k)$ так, что непрерывна слева в $d_k$ и справа в $c_k$}}
			}
		\]
		где $(\alpha; \beta) \bs K_\eps = \bscup_{k = 1}^\infty (c_k; d_k)$ в силу открытости. Осталось разобраться с непрерывностью:
		\begin{itemize}
			\item Если $\exists k \in \N \such x_0 \in (c_k; d_k)$, то непрерывность очевидным образом есть
			
			\item Если $x_0 \in [a; \alpha) \cup (\beta; b]$, то тоже есть непрерывность. При этом отметим, что константы в определении $\phi(x)$ должны быть подогнаны под левую непрерывность в $\alpha$ и правую непрерывность в $\beta$.
			
			\item Если $x_0 \in K_\eps$, то непрерывность тоже есть. Действительно, $h_n \rra f$ и с какого-то номера каждая $h_n$ будет непрерывна в $x_0$ как постоянная функция.
			
			\item Если $x_0 \in [\alpha; \beta] \bs K_\eps$ и при этом $\forall k \in \N\ x_0 \notin (c_k; d_k]$, то рассмотрим произвольную возрастающую последовательность $\{x_k\}_{k = 1}^\infty \subset [a; b] \bs K_\eps$ (не умаляя общности, можем потребовать это, ибо есть открытость множества). Для оценки образов элементов последовательности, разобьём её на конечные группы по вхождению в интервалы $(c_i; d_i)$. Более формально:
			\begin{align*}
				&{x_1, \ldots, x_{t_1} \in (c_{i_1}; d_{i_1})}
				\\
				&{\vdots}
				\\
				&{x_{t_l + 1}, \ldots, x_{t_{l + 1}} \in (c_{i_l}; d_{i_l})}
			\end{align*}
			По определению $\phi(x)$, значения всех элементов в каждой пачке зажаты между значениями $\phi(c_{i_l}) = f(c_{i_l})$, $\phi(d_{i_l}) = f(d_{i_l})$. Так как границы интервалов тоже стремятся к $x_0$ при $l \to \infty$, то и значения буду стремиться к $\phi(x_0)$ соответственно.
		\end{itemize}
		
		\item Теперь теорема доказана для ограниченных функций. Пусть теперь $f$ - неограниченная. Обозначим за $A_k = \{x \in [a; b] \colon |f(x)| > k\}$. Тогда верно, что $A_i \subset A_{i + 1}$, то есть
		\[
			\lim_{k \to \infty} A_k = \bigcap_{k = 1}^\infty A_k = \{x \in [a; b] \colon f(x) = \pm\infty\}
		\]
		Коль скоро исходная функция почти всюду конечна, то
		\[
			\mu(\lim_{k \to \infty} A_k) = \lim_{k \to \infty} \mu(A_k) = 0
		\]
		Наконец, зафиксируем $\eps > 0$ и возьмём такое $k$, что $\mu(A_k) < \eps / 2$ и рассмотрим функцию $g(x)$ следующего вида:
		\[
			g(x) = \System{
				&{f(x),\ x \notin A_k}
				\\
				&{k,\ x \in A_k}
			}
		\]
		Она ограничена и измерима, а значит можно применить предположение:
		\[
			\exists \phi(x) \such \mu(\{x \in [a; b] \colon g(x) \neq \phi(x)\}) < \frac{\eps}{2}
		\]
		По свойствам меры получаем нужную оценку:
		\[
			\mu(\{x \in [a; b] \colon f(x) \neq \phi(x)\}) < \mu(\{x \notin A_k \colon f(x) = g(x) \neq \phi(x)\}) + \mu(A_k) < \eps
		\]
	\end{itemize}
\end{proof}